<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- The HTML 4.01 Transitional DOCTYPE declaration-->
<!-- above set at the top of the file will set     -->
<!-- the browser's rendering engine into           -->
<!-- "Quirks Mode". Replacing this declaration     -->
<!-- with a "Standards Mode" doctype is supported, -->
<!-- but may lead to some differences in layout.   -->

<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  </head>
  <body>
    
    <input type=text id="input-channel-name" size=20 value="/pippo/" >
    <button id="button-setup-channel">setup</button>
    <pre id='json'>
    </pre>
    
	
    <script>

    var xhr = null;
    function setupChannel(arg, observeTag ) {
      	var channelId = arg;
        if ( xhr ) {
                xhr.abort();
        }
      	xhr = new XMLHttpRequest();
    	xhr.onreadystatechange  =  function()
                                {
                                        if( xhr.readyState == 4 && xhr.status == 200)
                                        {
                                                    var newtag = parseInt(xhr.responseText);
                                                    setupChannel( channelId, newtag );
                                                    if ( newtag != observeTag ) {
        				                                loadStickyNotes( channelId );
                                                    }
                                        }
                                };
                                
    	xhr.open('GET', "../../db" + channelId + "?observe=1&tag="+observeTag, true);
    	xhr.send();
    }
    
    function loadStickyNotes(arg) { 
        jQuery.getJSON( "../../db" + arg , {}, function(data) {
        		$("#json").text( JSON.stringify(data, null, 10 ) );
        } );
    }
    
    </script>
    <script type="text/javascript" src="../jquery/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="../js/utils.js"></script>
    <script type="text/javascript" >
    	$(function() {
    		$("#button-setup-channel").click( function() {
    				setupChannel( $("#input-channel-name").val(), 1 ); 
    				loadStickyNotes( $("#input-channel-name").val() );
                    setHashValue("path", $("#input-channel-name").val() );
    			} );
    	    $("#input-channel-name").val( getHashValueDefault("path", "/") );
    	} );
    	
    	
    </script>
    
  </body>
</html>
